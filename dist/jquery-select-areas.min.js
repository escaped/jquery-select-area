(function(){var e,t,i,n,a;n=function(e,t){return null==t&&(t=!1),{width:e.width(),height:e.height(),top:t?e.offset().top:e.position().top,left:t?e.offset().left:e.position().left}},i={draggable:!0,resizeable:!0,disabled:!1,labels:!0,min_width:40,min_height:40},e=function(){function e(t,i,n,a,s,o){this.instance=t,this.id=null!=n?n:e.amount++,this.draggable=null!=a?a:!0,this.resizeable=null!=s?s:!0,null==o&&(o=!0),this.id>e.amount&&(e.amount=this.id+1),this.area=$("<div>").addClass("area").css(i),o&&this.area.append($("<p>").addClass("name").addClass("no-select").text(this.id)),this.instance.container.append(this.area),this.draggable&&this._make_draggable(),this.resizeable&&this._make_resizeable(),this._trigger_event("created")}return e.amount=0,e.prototype._trigger_event=function(e){this.instance.elem.trigger("area-"+e,{id:this.id,size:n(this.area)})},e.prototype._get_handle=function(e,t,i){var a;return a=$("<div>").addClass(e).on("mousedown",function(e){return function(t){var a;if(!e.instance.isDisabled()&&1===t.which)return t.stopPropagation(),e.area.css({"z-index":1e3}),a=n(e.area),e.area.on("mousemove",function(n){var s,o,r,h,l,d,p,u;n.preventDefault(),o=n.pageX-t.pageX,r=n.pageY-t.pageY,u=i(o,r),l=u[0],d=u[1],p=u[2],h=u[3],s={left:a.left+l,top:a.top+d,width:a.width+p,height:a.height+h},s.width<e.instance.options.min_width||s.height<e.instance.options.min_height||s.left+s.width>=e.instance.container.width()-1||s.top+s.height>=e.instance.container.height()-1||s.left<0||s.top<0||e.area.css(s)})}}(this)).on("mouseup",function(e){return function(i){e.instance.isDisabled()||(i.stopPropagation(),e.area.css({"z-index":10}),e.area.off("mousemove"),e._trigger_event(t))}}(this))},e.prototype._make_draggable=function(){this.area.addClass("area-draggable"),this._get_handle("drag-handle","moved",function(e,t){return[e,t,0,0]}).appendTo(this.area)},e.prototype._make_resizeable=function(){this.area.addClass("area-resizeable"),this._get_handle("resize-handle left","resized",function(e){return[e,0,-e,0]}).appendTo(this.area),this._get_handle("resize-handle right","resized",function(e){return[0,0,e,0]}).appendTo(this.area),this._get_handle("resize-handle top","resized",function(e,t){return[0,t,0,-t]}).appendTo(this.area),this._get_handle("resize-handle bottom","resized",function(e,t){return[0,0,0,t]}).appendTo(this.area),this._get_handle("resize-handle topleft","resized",function(e,t){return[e,t,-e,-t]}).appendTo(this.area),this._get_handle("resize-handle topright","resized",function(e,t){return[0,t,e,-t]}).appendTo(this.area),this._get_handle("resize-handle bottomleft","resized",function(e,t){return[e,0,-e,t]}).appendTo(this.area),this._get_handle("resize-handle bottomright","resized",function(e,t){return[0,0,e,t]}).appendTo(this.area)},e.prototype.getID=function(){return this.id},e.prototype.getDimensions=function(){return n(this.area)},e.prototype.isDraggable=function(){return this.draggable},e.prototype.isResizable=function(){return this.resizable},e.prototype.destroy=function(){return this.area.remove()},e}(),t=function(){function t(t,a){this.elem=t,null==a&&(a={}),this.options=$.extend(i,a),this.areas=[],this.selection=null,this.container=$("<div>").addClass("select-areas").css(n(this.elem,!0)),$("body").append(this.container),this.isDisabled()||this.enable(),this.container.on("mousedown",function(e){return function(t){var i,n;e.isDisabled()||1===t.which&&(e.selection&&e.container.trigger("mouseup"),i=t.pageX-e.container.offset().left,n=t.pageY-e.container.offset().top,e.selection=$("<div>").addClass("area-create").css({top:n,left:i,width:0,height:0}).appendTo(e.container),e.container.on("mousemove",function(t){var a,s,o,r,h,l;t.preventDefault(),s=t.pageX-e.container.offset().left,o=t.pageY-e.container.offset().top,l=Math.abs(s-i),a=Math.abs(o-n),r=i>s?i-l:i,h=n>o?n-a:n,e.selection.css({width:l,height:a,top:h,left:r})}))}}(this)).on("mouseup",function(t){return function(){var i;t.isDisabled()||(t.container.off("mousemove"),t.selection&&(i=n(t.selection),0!==i.width&&0!==i.height&&(t.areas.push(new e(t,i,null,t.options.draggable,t.options.resizeable,t.options.label)),t.__labelVisibility()),t.selection.remove(),t.selection=null))}}(this))}return t.prototype.disable=function(){this.options.disabled=!0,this.container.removeClass("area-enabled")},t.prototype.enable=function(){this.options.disabled=!1,this.container.addClass("area-enabled")},t.prototype.showLabels=function(e){return this.options.labels=e,this.__labelVisibility()},t.prototype.__labelVisibility=function(){return this.options.labels?$("p.name",this.container).removeClass("hide"):$("p.name",this.container).addClass("hide")},t.prototype.isDisabled=function(){return this.options.disabled},t.prototype.removeArea=function(e){var t,i,n,a,s;for(i=[],this.areas=this.areas.filter(function(t){return t.getID()!==e||!i.push(t)}),s=[],n=0,a=i.length;a>n;n++)t=i[n],t.destroy(),s.push(this.elem.trigger("area-removed",e));return s},t.prototype.addArea=function(t,i){return i.left>0&&i.left<=this.container.width()&&i.top>0&&i.top<=this.container.height()&&i.width>0&&i.height>0?(this.areas.push(new e(this,i,t,this.options.draggable,this.options.resizeable,this.options.label)),this.__labelVisibility()):void 0},t.prototype.getAreas=function(){var e,t,i,n,a;for(e={},a=this.areas,i=0,n=a.length;n>i;i++)t=a[i],e[t.getID()]=t.getDimensions();return e},t}(),a="undefined"!=typeof exports&&null!==exports?exports:this,a.SelectAreas=t,jQuery.fn.extend({selectAreas:function(e){var i,n;return i=$(this),n=i.data("select-area"),n||i.data("select-area",n=new t(this,e)),n}})}).call(this);