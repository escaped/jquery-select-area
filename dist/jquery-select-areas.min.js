(function(){var e,t,n,a,i;a=function(e,t){return null==t&&(t=!1),{width:e.width(),height:e.height(),top:t?e.offset().top:e.position().top,left:t?e.offset().left:e.position().left}},n={draggable:!0,disabled:!1,labels:!0},e=function(){function e(t,n,a,i){this.instance=t,this.draggable=null!=a?a:!0,null==i&&(i=!0),this.id=e.amount++,this.area=$("<div>").addClass("area").css(n),i&&this.area.append($("<p>").addClass("name").addClass("no-select").text(this.id)),this.instance.container.append(this.area),a&&this._make_draggable(),this._trigger_event("created")}return e.amount=0,e.prototype._trigger_event=function(e){this.instance.elem.trigger("area-"+e,{id:this.id,size:a(this.area)})},e.prototype._make_draggable=function(){var e;e=$("<div>").addClass("drag-handle").on("mouseover",function(e){return function(){e.area.addClass("over")}}(this)).on("mouseleave",function(e){return function(){e.area.removeClass("over")}}(this)).on("mousedown",function(e){return function(t){var n,a;if(!e.instance.isDisabled()&&1===event.which)return t.stopPropagation(),e.area.css({"z-index":1e3}),n=t.pageX-e.area.offset().left,a=t.pageY-e.area.offset().top,e.area.on("mousemove",function(t){var i,s;t.preventDefault(),i=t.pageX-e.instance.container.offset().left-n,s=t.pageY-e.instance.container.offset().top-a,i+e.area.width()>=e.instance.container.width()-1||s+e.area.height()>=e.instance.container.height()-1||0>i||0>s||e.area.css({left:i,top:s})})}}(this)).on("mouseup",function(e){return function(t){e.instance.isDisabled()||(t.stopPropagation(),e.area.css({"z-index":10}),e.area.off("mousemove"),e._trigger_event("moved"))}}(this)),this.area.addClass("area-draggable").append(e)},e.prototype.getID=function(){return this.id},e.prototype.getDimensions=function(){return a(this.area)},e.prototype.isDraggable=function(){return this.draggable},e.prototype.destroy=function(){return this.area.remove()},e}(),t=function(){function t(t,i){this.elem=t,null==i&&(i={}),this.options=$.extend(n,i),this.areas=[],this.selection=null,this.container=$("<div>").addClass("select-areas").css(a(this.elem,!0)),$("body").append(this.container),this.isDisabled()||this.enable(),this.container.on("mousedown",function(e){return function(t){var n,a;e.isDisabled()||1===event.which&&(e.selection&&e.container.trigger("mouseup"),n=t.pageX-e.container.offset().left,a=t.pageY-e.container.offset().top,e.selection=$("<div>").addClass("area-create").css({top:a,left:n,width:0,height:0}).appendTo(e.container),e.container.on("mousemove",function(t){var i,s,o,r,l,c;t.preventDefault(),s=t.pageX-e.container.offset().left,o=t.pageY-e.container.offset().top,c=Math.abs(s-n),i=Math.abs(o-a),r=n>s?n-c:n,l=a>o?a-i:a,e.selection.css({width:c,height:i,top:l,left:r})}))}}(this)).on("mouseup",function(t){return function(){var n;t.isDisabled()||(t.container.off("mousemove"),t.selection&&(n=a(t.selection),0!==n.width&&0!==n.height&&(t.areas.push(new e(t,n,t.options.draggable,t.options.label)),t.__labelVisibility()),t.selection.remove(),t.selection=null))}}(this))}return t.prototype.disable=function(){this.options.disabled=!0,this.container.removeClass("area-enabled")},t.prototype.enable=function(){this.options.disabled=!1,this.container.addClass("area-enabled")},t.prototype.showLabels=function(e){return this.options.labels=e,this.__labelVisibility()},t.prototype.__labelVisibility=function(){return this.options.labels?$("p.name",this.container).removeClass("hide"):$("p.name",this.container).addClass("hide")},t.prototype.isDisabled=function(){return this.options.disabled},t.prototype.removeArea=function(e){var t,n,a,i,s;for(n=[],this.areas=this.areas.filter(function(t){return t.getID()!==e||!n.push(t)}),s=[],a=0,i=n.length;i>a;a++)t=n[a],t.destroy(),s.push(this.elem.trigger("area-removed",e));return s},t.prototype.getAreas=function(){var e,t,n,a,i;for(e={},i=this.areas,n=0,a=i.length;a>n;n++)t=i[n],e[t.getID()]=t.getDimensions();return e},t}(),i="undefined"!=typeof exports&&null!==exports?exports:this,i.SelectAreas=t,jQuery.fn.extend({selectAreas:function(e){var n,a;return n=$(this),a=n.data("select-area"),a||n.data("select-area",a=new t(this,e)),a}})}).call(this);